<form style="margin: 5px;" [formGroup]="myForm" (ngSubmit)="onSubmit()" >
<mat-accordion>
   
    <mat-expansion-panel [expanded]="true" hideToggle>
        
        <mat-expansion-panel-header>
            <mat-panel-title>
                 Patient Details
            </mat-panel-title>
            <mat-icon>account_circle</mat-icon>
        </mat-expansion-panel-header>
<div formGroupName="patientDetails" class="gridContainer">
    <div class="gridColumn">
        <mat-form-field appearance="fill">
            <mat-label>First Name</mat-label>
            <input matInput formControlName="firstName">
            <mat-error *ngIf="myForm.get('patientDetails').get('firstName').hasError('required')">
                First name is required
            </mat-error>
        </mat-form-field>
    </div>
    
    <div class="gridColumn">
        <mat-form-field appearance="fill">
            <mat-label>Last Name</mat-label>
            <input matInput formControlName="lastName">
            <mat-error *ngIf="myForm.get('patientDetails').get('lastName').hasError('required')">
                Last name is required
            </mat-error>
        </mat-form-field>
    </div>
    <div class="gridColumn">
        <mat-form-field appearance="fill">
            <mat-label>Email</mat-label>
            <input matInput formControlName="email">
            <mat-error *ngIf="myForm.get('patientDetails').get('email').hasError('required')">
                Email is required
            </mat-error>
            <mat-error *ngIf="myForm.get('patientDetails').get('email').hasError('email')">
                Enter a valid email
            </mat-error>
        </mat-form-field>
    </div>
    <div class="gridColumn">
        <mat-form-field appearance="fill">
            <mat-label>Phone</mat-label>
            <input matInput formControlName="phone">
            <mat-error *ngIf="myForm.get('patientDetails').get('phone').hasError('required')">
                Phone number is required
            </mat-error>
        </mat-form-field>
    </div>
    <div class="gridColumn">
        <mat-form-field appearance="fill">
            <mat-label>Adhar</mat-label>
            <input matInput formControlName="adhar">
            <mat-error *ngIf="myForm.get('patientDetails').get('adhar').hasError('required')">
                adhar number is required
            </mat-error>
            <mat-error *ngIf="myForm.get('patientDetails').get('adhar').touched&&(myForm.get('patientDetails').get('adhar').hasError('minlength')||myForm.get('patientDetails').get('adhar').hasError('maxlength'))">
                invalid adhar
            </mat-error>
        </mat-form-field>
    </div>
    <div class="gridColumn">
        <mat-form-field appearance="fill">
            <mat-label>Date of Birth</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="dateOfBirth">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error *ngIf="myForm.get('patientDetails').get('dateOfBirth').hasError('required')">
                Date of birth is required
            </mat-error>
            <mat-error *ngIf="myForm.get('patientDetails').get('dateOfBirth').hasError('dateOfBirth')">
                {{myForm.get('patientDetails').get('dateOfBirth').errors['dateOfBirth']}}
            </mat-error>
        </mat-form-field>
    </div>
    <div class="gridColumn">
        <mat-form-field appearance="fill">
            <mat-label>Gender</mat-label>
            <mat-select formControlName="gender">
                <mat-option value="male">Male</mat-option>
                <mat-option value="female">Female</mat-option>
                <mat-option value="other">Other</mat-option>
            </mat-select>
            <mat-error *ngIf="myForm.get('patientDetails').get('gender').hasError('required')">
                Gender is required
            </mat-error>
        </mat-form-field>
    </div>
    <div formGroupName="address" class="gridColumn">
            <mat-form-field appearance="fill">
                <mat-label>AddressLine 1</mat-label>
                <input matInput formControlName="addressLine1">
                <mat-error *ngIf="myForm.get('patientDetails').get('address').get('addressLine1').hasError('requiredLine1')">
                    AddressLine 1 is required
                </mat-error>
            </mat-form-field>
    </div>
    <div formGroupName="address" class="gridColumn">
            <mat-form-field appearance="fill">
                <mat-label>AddressLine 2</mat-label>
                <input matInput formControlName="addressLine2">
                <mat-error *ngIf="myForm.get('patientDetails').get('address').get('addressLine2').hasError('requiredLine2')">
                    AddressLine 2 is required
                </mat-error>
            </mat-form-field>
    </div>
    <div formGroupName="address" class="gridColumn">
            <mat-form-field appearance="fill">
                <mat-label>City</mat-label>
                <input matInput formControlName="city">
                <mat-error *ngIf="myForm.get('patientDetails').get('address').get('city').hasError('required')">
                    City is required
                </mat-error>
            </mat-form-field>
    </div>
    
    <div formGroupName="address" class="gridColumn">
        <mat-form-field appearance="fill">
            <mat-label>State</mat-label>
            <input matInput formControlName="state">
            <mat-error *ngIf="myForm.get('patientDetails').get('address').get('state').hasError('required')">
                State is required
            </mat-error>
        </mat-form-field>
    </div>
    <div formGroupName="address" class="gridColumn">
            <mat-form-field appearance="fill">
                <mat-label>Pincode</mat-label>
                <input matInput formControlName="pincode">
                <mat-error *ngIf="myForm.get('patientDetails').get('address').get('pincode').hasError('required')">
                    Pincode is required
                </mat-error>
                <mat-error *ngIf="myForm.get('patientDetails').get('address').get('pincode').hasError('pattern')">
                    Pincode is invalid
                </mat-error>
            </mat-form-field>
    </div>
    <div  class="gridColumn">
        <app-referred-doctor-autocomplete [doctorFormControl]="getReferredDoctorControl()">

        </app-referred-doctor-autocomplete>
 </div>
 <div  class="gridColumn">
     <app-reference-center-auto-complete [selectedCenterctrl]="getControl()">

     </app-reference-center-auto-complete>
 </div>
</div>
    </mat-expansion-panel>
    <mat-expansion-panel hideToggle>
        <mat-expansion-panel-header>
            <mat-panel-title>
                Test Details
            </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="gridContainer">
            <div class="gridColumn" style="grid-column: 1 /span 3;">
                <mat-form-field class="example-full-width">
        
                    <mat-label>Tests</mat-label>
                    <mat-chip-grid #chipgrid  aria-label="Test Selections">
                        <mat-chip-row (removed)="remove(t)" *ngFor="let t of selectedOptions">{{t.name}}
                            <button matChipRemove [attr.aria-label]="'remove'">
                                <mat-icon>cancel</mat-icon>
                            </button>
                        </mat-chip-row>
                    </mat-chip-grid>
                  
                    <input type="text" [matChipInputFor]="chipgrid"  placeholder="Pick one" aria-label="Number" matInput [formControl]="testInput"
                         (matChipInputTokenEnd)="add($event)" [matAutocomplete]="auto">
                    <mat-autocomplete  #auto="matAutocomplete"  (optionSelected)="OnAutoCompleteSelect($event)">
                        @for (option of filteredOptions | async; track option.name) {
                        <mat-option [value]="option">{{option.name}}</mat-option>
                        }
                    </mat-autocomplete>
                    <span style="color: red;" *ngIf="myForm.hasError('tests')&&testInput.touched">
                        Tests is required
                    </span>
                </mat-form-field>
            </div>
            <div *ngIf="selectedOptions?.length>0" class="gridColumn" style="grid-column: 1 / span 5;">
                <p>Selected Tests</p>
               <table mat-table [dataSource]="selectedOptions">
                <ng-container matColumnDef="testId">
                    <th mat-header-cell *matHeaderCellDef> Id </th>
                    <td mat-cell *matCellDef="let element"> {{element.testId}} </td>
                  </ng-container>
                  <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef> Name </th>
                    <td mat-cell *matCellDef="let element"> {{element.name}} </td>
                  </ng-container>
                  <ng-container matColumnDef="price">
                    <th mat-header-cell *matHeaderCellDef> Price </th>
                    <td mat-cell *matCellDef="let element"> {{element.price}} </td>
                  </ng-container>
                  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
               </table>
        
            </div>
        <div formGroupName="billDetails">
            <div class="gridColumn" style="grid-column: 1 / span 1;">
                <mat-form-field>
                    <mat-label>
                        Discount Applied
                    </mat-label>
                    <input matInput formControlName="discount" type="number">
                    <span *ngIf="myForm.get('billDetails').hasError('discount')" style="color: red;">
                        invalid discount
                    </span>
                    
                </mat-form-field>
               
            </div>
            <div class="gridColumn" style="grid-column: 2 / span 1;">
                <mat-form-field dense>
                    <mat-label>
                        Total Billed Amount 
                    </mat-label>
                    <input  matInput   formControlName="totalBill" type="number">
                </mat-form-field>
            </div>
            <div class="gridColumn" style="grid-column: 3 / span 1;">
                <mat-form-field dense>
                    <mat-label>
                        Amount Paid 
                    </mat-label>
                    <input [errorStateMatcher]="errorMatcher"  matInput   formControlName="amountPaid" type="number">
                    <mat-error *ngIf="myForm.get('billDetails').get('amountPaid').hasError('required')">
                        Amount Paid is required
                    </mat-error>
                    <mat-error *ngIf="myForm.hasError('amountPaid')">{{myForm.errors['amountPaid']}}</mat-error>
                </mat-form-field>
            </div>
        </div>
        </div>
        <mat-action-row>
            <button type="reset" mat-button>Cancel</button>
            <button type="submit" mat-button [disabled]="myForm.invalid">Submit</button>
           
          </mat-action-row>
    </mat-expansion-panel>

</mat-accordion>
</form>